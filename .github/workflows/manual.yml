name: Simple test to build a draft release

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the main branch
  push:
    branches: [ release ]
  pull_request:
    branches: [ release ]
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:
  
jobs:  
  build:    
    runs-on: windows-latest
    
    steps:      
      - uses: actions/checkout@v3

      - name: bump version and push 
        id: bump_tag
        uses: mathieudutour/github-tag-action@v6.1
        with:
          github_token: ${{ secrets.github_token }}
          default_bump: patch
          default_prerelease_bump: prerelease
          tag_prefix: v
          release_branches: master,main,release
          create_annotated_tag: false
          fetch_all_tags: false
          dry_run: false
          
      - name: Read About file
        if: contains(github.ref , 'release')
        id: getAbout
        run: |
          chcp 65001
          echo @"
          ABOUT=
          $(Get-Content README.md)
          "@ | Out-File -FilePath $Env:GITHUB_ENV -Encoding utf8 -Append
          echo "${{ env.ABOUT }}"
          echo $env:ABOUT
      - name: Create a release
        if: contains(github.ref , 'release')
        id: create_release
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: ${{ github.ref }}
          release_name: Iris Screen Exporter V${{ steps.bump_tag.outputs.new_version }}
          body: ${{ env.ABOUT }}
          draft: true
          prerelease: false
